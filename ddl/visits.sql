-- metrica.visits_<id трансфера> definition

CREATE TABLE metrica.visits_<id трансфера>
(
    `CounterID` UInt32,
    `StartDate` Date,
    `CounterUserIDHash` UInt64,
    `VisitID` UInt64,
    `Sign` Int8,
    `VisitVersion` UInt32,
    `BrowserCountry` Nullable(UInt16),
    `BrowserEngineID` Nullable(UInt8),
    `BrowserEngineStrID` Nullable(String),
    `BrowserEngineVersion1` Nullable(UInt16),
    `BrowserEngineVersion2` Nullable(UInt16),
    `BrowserEngineVersion3` Nullable(UInt16),
    `BrowserEngineVersion4` Nullable(UInt16),
    `BrowserLanguage` Nullable(UInt16),
    `CDPOrder.Cost` Array(UInt64),
    `CDPOrder.CreateTime` Array(DateTime),
    `CDPOrder.ID` Array(UInt64),
    `CDPOrder.ProductNames` Array(Array(String)),
    `CDPOrder.ProductQuantities` Array(Array(UInt32)),
    `CDPOrder.Revenue` Array(UInt64),
    `CDPOrder.Status` Array(UInt8),
    `CDPOrder.UpdateTime` Array(DateTime),
    `CDPOrder.UserID` Array(UInt64),
    `CDPOrder.Version` Array(UInt32),
    `ClientIP` Nullable(UInt32),
    `ClientIP6` Nullable(FixedString(16)),
    `ClientTimeZone` Nullable(Int16),
    `CookieEnable` Nullable(UInt8),
    `DevicePixelRatio` Nullable(Float32),
    `Duration` Nullable(UInt32),
    `EAction.EventTime` Array(DateTime),
    `EAction.ProductBrand` Array(String),
    `EAction.ProductCategory` Array(String),
    `EAction.ProductCategory1` Array(String),
    `EAction.ProductCategory2` Array(String),
    `EAction.ProductCategory3` Array(String),
    `EAction.ProductCategory4` Array(String),
    `EAction.ProductCategory5` Array(String),
    `EAction.ProductCoupon` Array(String),
    `EAction.ProductCurrency` Array(String),
    `EAction.ProductCurrencyID` Array(UInt16),
    `EAction.ProductID` Array(String),
    `EAction.ProductList` Array(String),
    `EAction.ProductName` Array(String),
    `EAction.ProductPosition` Array(Int32),
    `EAction.ProductPrice` Array(Int64),
    `EAction.ProductQuantity` Array(Int64),
    `EAction.ProductVariant` Array(String),
    `EAction.Type` Array(UInt8),
    `EAction.TypeStr` Array(String),
    `EAction.URL` Array(String),
    `EActionOverflow` Nullable(UInt8),
    `EndURL` Nullable(String),
    `EPurchase.Affiliation` Array(String),
    `EPurchase.Coupon` Array(String),
    `EPurchase.Currency` Array(String),
    `EPurchase.CurrencyID` Array(UInt16),
    `EPurchase.EventTime` Array(DateTime),
    `EPurchase.ID` Array(String),
    `EPurchase.ProductQuantity` Array(Int64),
    `EPurchase.Revenue` Array(Int64),
    `EPurchase.Shipping` Array(Int64),
    `EPurchase.Tax` Array(Int64),
    `EPurchaseOverflow` Nullable(UInt8),
    `EPurchaseWithProducts.Affiliation` Array(String),
    `EPurchaseWithProducts.Coupon` Array(String),
    `EPurchaseWithProducts.Currency` Array(String),
    `EPurchaseWithProducts.CurrencyID` Array(UInt16),
    `EPurchaseWithProducts.EventTime` Array(DateTime),
    `EPurchaseWithProducts.ID` Array(String),
    `EPurchaseWithProducts.ProductBrand` Array(String),
    `EPurchaseWithProducts.ProductCategory` Array(String),
    `EPurchaseWithProducts.ProductCategory1` Array(String),
    `EPurchaseWithProducts.ProductCategory2` Array(String),
    `EPurchaseWithProducts.ProductCategory3` Array(String),
    `EPurchaseWithProducts.ProductCategory4` Array(String),
    `EPurchaseWithProducts.ProductCategory5` Array(String),
    `EPurchaseWithProducts.ProductCoupon` Array(String),
    `EPurchaseWithProducts.ProductCurrency` Array(String),
    `EPurchaseWithProducts.ProductCurrencyID` Array(UInt16),
    `EPurchaseWithProducts.ProductID` Array(String),
    `EPurchaseWithProducts.ProductList` Array(String),
    `EPurchaseWithProducts.ProductName` Array(String),
    `EPurchaseWithProducts.ProductPosition` Array(Int32),
    `EPurchaseWithProducts.ProductPrice` Array(Int64),
    `EPurchaseWithProducts.ProductVariant` Array(String),
    `EPurchaseWithProducts.Quantity` Array(Int64),
    `EPurchaseWithProducts.Revenue` Array(Int64),
    `EPurchaseWithProducts.Shipping` Array(Int64),
    `EPurchaseWithProducts.Tax` Array(Int64),
    `EPurchaseWithProductsOverflow` Nullable(UInt8),
    `FirstPartyCookie` Nullable(UInt64),
    `FirstVisit` Nullable(DateTime),
    `Goals.CallFirstTimeCaller` Array(UInt32),
    `Goals.CallHoldDuration` Array(UInt32),
    `Goals.CallMissed` Array(UInt32),
    `Goals.CallTag` Array(String),
    `Goals.CallTalkDuration` Array(UInt32),
    `Goals.CallTrackerURL` Array(String),
    `Goals.CallURL` Array(String),
    `Goals.CurrencyID` Array(UInt32),
    `Goals.EventTime` Array(DateTime),
    `Goals.ID` Array(UInt32),
    `Goals.OrderID` Array(String),
    `Goals.Price` Array(Int64),
    `Goals.Serial` Array(UInt32),
    `HasGoalReachesOverflow` Nullable(UInt8),
    `IsBounce` Nullable(UInt8),
    `IsMobile` Nullable(UInt8),
    `IsTablet` Nullable(UInt8),
    `IsTV` Nullable(UInt8),
    `JavascriptEnable` Nullable(UInt8),
    `LinkURL` Nullable(String),
    `MobilePhoneModel` Nullable(String),
    `MobilePhoneVendor` Nullable(UInt16),
    `MobilePhoneVendorStr` Nullable(String),
    `NetworkType` Nullable(UInt8),
    `NetworkTypeStr` Nullable(String),
    `OS` Nullable(UInt8),
    `OSFamily` Nullable(String),
    `OSName` Nullable(String),
    `OSRoot` Nullable(UInt8),
    `OSRootStr` Nullable(String),
    `OSStr` Nullable(String),
    `PageViews` Nullable(Int32),
    `ParsedParams.Key1` Array(String),
    `ParsedParams.Key10` Array(String),
    `ParsedParams.Key2` Array(String),
    `ParsedParams.Key3` Array(String),
    `ParsedParams.Key4` Array(String),
    `ParsedParams.Key5` Array(String),
    `ParsedParams.Key6` Array(String),
    `ParsedParams.Key7` Array(String),
    `ParsedParams.Key8` Array(String),
    `ParsedParams.Key9` Array(String),
    `ParsedParams.Quantity` Array(UInt32),
    `PublisherEvents.AdvEngineID` Array(UInt8),
    `PublisherEvents.AdvEngineStrID` Array(String),
    `PublisherEvents.ArticleHeight` Array(UInt32),
    `PublisherEvents.ArticleID` Array(UInt32),
    `PublisherEvents.Authors` Array(Array(String)),
    `PublisherEvents.Chars` Array(UInt32),
    `PublisherEvents.EventID` Array(UInt64),
    `PublisherEvents.FromArticleID` Array(UInt32),
    `PublisherEvents.HasRecircled` Array(UInt8),
    `PublisherEvents.HitEventTime` Array(DateTime),
    `PublisherEvents.InvolvedTime` Array(UInt32),
    `PublisherEvents.MessengerID` Array(UInt8),
    `PublisherEvents.MessengerStrID` Array(String),
    `PublisherEvents.PublicationTime` Array(DateTime),
    `PublisherEvents.RecommendationSystemID` Array(UInt8),
    `PublisherEvents.RecommendationSystemStrID` Array(String),
    `PublisherEvents.ReferrerDomain` Array(String),
    `PublisherEvents.ReferrerPath` Array(String),
    `PublisherEvents.Rubric` Array(String),
    `PublisherEvents.Rubric2` Array(String),
    `PublisherEvents.ScrollDown` Array(UInt8),
    `PublisherEvents.SearchEngineID` Array(UInt16),
    `PublisherEvents.SearchEngineStrID` Array(String),
    `PublisherEvents.SocialSourceNetworkID` Array(UInt8),
    `PublisherEvents.SocialSourceNetworkStrID` Array(String),
    `PublisherEvents.Title` Array(String),
    `PublisherEvents.Topics` Array(Array(String)),
    `PublisherEvents.TrafficSourceID` Array(Int8),
    `PublisherEvents.TrafficSourceStrID` Array(String),
    `PublisherEvents.TurboType` Array(UInt8),
    `PublisherEvents.TurboTypeStr` Array(String),
    `PublisherEvents.URLCanonical` Array(String),
    `Referer` Nullable(String),
    `RegionID` Nullable(UInt32),
    `ResolutionDepth` Nullable(UInt8),
    `ResolutionHeight` Nullable(UInt16),
    `ResolutionWidth` Nullable(UInt16),
    `StartURL` Nullable(String),
    `TrafficSource.AdvEnginePlaceID` Array(UInt64),
    `TrafficSource.AdvEnginePlaceStrID` Array(String),
    `TrafficSource.ClickBannerID` Array(UInt64),
    `TrafficSource.ClickDirectCampaignID` Array(UInt32),
    `TrafficSource.ClickGroupBannerID` Array(UInt64),
    `TrafficSource.ClickTargetType` Array(UInt16),
    `TrafficSource.CLID` Array(UInt32),
    `TrafficSource.DirectCLID` Array(UInt64),
    `TrafficSource.Domain` Array(String),
    `TrafficSource.FromTag` Array(String),
    `TrafficSource.GCLID` Array(String),
    `TrafficSource.HasGCLID` Array(UInt8),
    `TrafficSource.ID` Array(Int8),
    `TrafficSource.MessengerID` Array(UInt8),
    `TrafficSource.MessengerStrID` Array(String),
    `TrafficSource.Model` Array(UInt8),
    `TrafficSource.ModelStr` Array(String),
    `TrafficSource.OpenstatAdID` Array(String),
    `TrafficSource.OpenstatCampaignID` Array(String),
    `TrafficSource.OpenstatServiceName` Array(String),
    `TrafficSource.OpenstatSourceID` Array(String),
    `TrafficSource.QRCodeProviderID` Array(UInt16),
    `TrafficSource.QRCodeProviderStrID` Array(String),
    `TrafficSource.RecommendationSystemID` Array(UInt8),
    `TrafficSource.RecommendationSystemStrID` Array(String),
    `TrafficSource.SearchEngineID` Array(UInt16),
    `TrafficSource.SearchEngineRootID` Array(UInt16),
    `TrafficSource.SearchEngineRootStrID` Array(String),
    `TrafficSource.SearchEngineStrID` Array(String),
    `TrafficSource.SocialSourceNetworkID` Array(UInt8),
    `TrafficSource.SocialSourceNetworkStrID` Array(String),
    `TrafficSource.SocialSourcePage` Array(String),
    `TrafficSource.StartTime` Array(DateTime),
    `TrafficSource.StrID` Array(String),
    `TrafficSource.UTMCampaign` Array(String),
    `TrafficSource.UTMContent` Array(String),
    `TrafficSource.UTMMedium` Array(String),
    `TrafficSource.UTMSource` Array(String),
    `TrafficSource.UTMTerm` Array(String),
    `TrafficSource.YQRID` Array(String),
    `UserAgent` Nullable(UInt8),
    `UserAgentMajor` Nullable(UInt16),
    `UserAgentStr` Nullable(String),
    `UserAgentVersion2` Nullable(UInt32),
    `UserAgentVersion3` Nullable(UInt32),
    `UserAgentVersion4` Nullable(UInt32),
    `UTCStartTime` Nullable(DateTime),
    `WatchIDs` Array(UInt64),
    `WindowClientHeight` Nullable(UInt16),`WindowClientWidth` Nullable(UInt16)
)
ENGINE = ReplicatedVersionedCollapsingMergeTree
('/clickhouse/tables/{shard}/metrica.visits_<id трансфера>_cdc',
 '{replica}',
 Sign,
 VisitVersion)
PARTITION BY toMonday(StartDate)
ORDER BY (CounterID,
 StartDate,
 CounterUserIDHash,
 VisitID)
SAMPLE BY CounterUserIDHash
SETTINGS index_granularity = 8192;